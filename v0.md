# OpenClaw Orchestrator v0

## Cíl

Minimální app pro správu OpenClaw agentů na Hetzner Cloud.

---

## Scope v0

### IN ✅

1. **Credential management**
   - Uložení Hetzner API tokenu (secure storage)
   - Uložení Anthropic API key (secure storage)
   - Uložení Telegram bot tokenů (secure storage)

2. **Agent discovery**
   - Načtení serverů z Hetzner s labelem `openclaw=true`
   - Pro každý server fetch `https://<ip>/.well-known/openclaw.json`
   - Zobrazení seznamu agentů se statusem

3. **Agent spawn**
   - Formulář: jméno, region, VPS size, Telegram bot token
   - Deploy přes Hetzner API + cloud-init
   - Automatické nastavení labels

4. **Agent actions**
   - Destroy (smazání VPS)
   - Reboot
   - View IP (pro ruční SSH)

### OUT ❌ (later)

- Automatická tvorba Telegram botů
- Generování avatarů
- SSH terminal v app
- Multi-projekt support
- Agent-to-agent komunikace
- "Virtual office" vizualizace

---

## Tech Stack

| Komponenta | Technologie | Důvod |
|------------|-------------|-------|
| Frontend | **Expo (React Native)** | Web + iOS + Android, jeden kód |
| Secure storage | `expo-secure-store` | Keychain na iOS, Keystore na Android, encrypted na web |
| State | Zustand | Jednoduchý, lightweight |
| API calls | Fetch | Hetzner API je CORS-friendly |
| Styling | Tailwind (NativeWind) | Rychlý development |

---

## Data Model

### Credentials (local secure storage)

```typescript
interface Credentials {
  hetznerToken: string;
  anthropicKey: string;
  telegramBots: {
    name: string;
    token: string;
  }[];
}
```

### Agent (from Hetzner + discovery)

```typescript
interface Agent {
  // From Hetzner API
  serverId: number;
  name: string;
  ip: string;
  status: "running" | "off" | "starting";
  created: string;
  datacenter: string;
  serverType: string;
  
  // From /.well-known/openclaw.json
  openclaw?: {
    version: string;
    status: "running" | "starting" | "error";
    channels: string[];
    telegramBot?: string;
    uptime?: number;
  };
}
```

---

## Hetzner Labels

Servery vytvořené orchestratorem mají:

```
openclaw: "true"              # identifikace
openclaw-name: "<agent_name>" # jméno agenta
```

---

## Agent Discovery Endpoint

Každý agent servíruje `GET https://<ip>/.well-known/openclaw.json`:

```json
{
  "name": "Pete",
  "version": "2026.1.30",
  "status": "running",
  "channels": ["telegram"],
  "telegramBot": "@PeteAIBot",
  "uptime": 86400
}
```

**Implementace:** Caddy route → OpenClaw status endpoint (nebo statický JSON generovaný při startu).

---

## User Flows

### 1. První spuštění

```
App start
  → Credentials screen
  → User zadá Hetzner token
  → User zadá Anthropic key
  → Save to secure storage
  → Redirect to agent list
```

### 2. Agent list

```
Agent list screen
  → Fetch Hetzner servers (label: openclaw=true)
  → For each: fetch /.well-known/openclaw.json
  → Display list with status
  → Pull-to-refresh
```

### 3. Spawn agent

```
"+" button
  → Spawn form:
     - Name (required)
     - Region (dropdown: fsn1, nbg1, hel1)
     - Size (dropdown: cx22, cx32, cx42)
     - Telegram bot token (optional)
  → "Deploy" button
  → POST to Hetzner API (create server with cloud-init)
  → Show progress
  → Return to list
```

### 4. Agent actions

```
Tap agent in list
  → Detail screen:
     - Status, IP, created date
     - Telegram bot link (if configured)
     - Actions: Reboot, Destroy
  → Destroy requires confirmation
```

---

## Screens

```
┌─────────────────────────────────────────┐
│  1. Credentials (first run / settings)  │
│  2. Agent List (main screen)            │
│  3. Agent Detail                        │
│  4. Spawn Form                          │
└─────────────────────────────────────────┘
```

---

## Cloud-init Changes

Rozšířit `cloud-init-openclaw.yml`:

1. Přidat Caddy route pro `/.well-known/openclaw.json`
2. Přidat script co generuje discovery JSON
3. Labels se nastaví přes Hetzner API při vytvoření (ne v cloud-init)

---

## API Reference

### Hetzner (používané endpointy)

```
GET  /v1/servers?label_selector=openclaw=true
POST /v1/servers  (create with cloud-init)
DELETE /v1/servers/{id}
POST /v1/servers/{id}/actions/reboot
```

Docs: https://docs.hetzner.cloud/

---

## Success Criteria v0

- [ ] App běží na webu (Expo web)
- [ ] Credentials uloženy secure (ne v plaintext)
- [ ] Vidím seznam existujících agentů z Hetzner
- [ ] Můžu deployovat nového agenta jedním kliknutím
- [ ] Můžu agenta smazat
- [ ] Agent ukazuje svůj status přes discovery endpoint

---

## Open Questions

1. **Kam repo?** `PeteBrabec/openclaw-orchestrator` (existuje)
2. **Domain?** Zatím localhost, později např. `orchestrator.openclaw.ai`
3. **Auth pro discovery endpoint?** v0 bez auth (public JSON), později token

---

## Next Steps

1. ✅ Schválit tento spec
2. Scaffold Expo projekt
3. Implementovat credentials screen
4. Implementovat agent list + discovery
5. Implementovat spawn flow
6. Update cloud-init pro discovery endpoint
7. Test end-to-end
